<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PROOF</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background: #0d0d0d;
      color: #f0f0f0;
      font-family: system-ui, sans-serif;
      padding: 2rem;
      max-width: 800px;
      margin: auto;
    }
    h1, h2 {
      text-align: center;
    }
    .upload-box {
      border: 2px dashed #555;
      padding: 3rem;
      cursor: pointer;
      max-width: 700px;
      border-radius: 12px;
      background: #1a1a1a;
      transition: border-color 0.3s;
      text-align: center;
      margin: 2rem auto 0;
    }
    .upload-box:hover {
      border-color: #00aaff;
    }
    .btn-submit, .btn-cancel, .btn-blue {
      padding: 0.8rem 2rem;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin: 1rem 0.5rem;
    }
    .btn-submit { background-color: #2196F3; color: white; }
    .btn-cancel { background-color: #f44336; color: white; }
    .btn-blue { background-color: #2196F3; color: white; display: block; margin: 2rem auto; }

    .example-image, .result-image, #preview-image {
      width: 100%;
      max-width: 400px;
      border-radius: 10px;
      display: block;
      margin: 1rem auto;
    }

    .section {
      margin: 2rem auto;
      max-width: 700px;
    }
    .section p { line-height: 1.6; }

    .group-block { margin-bottom: 1rem; }
    .group-block p { margin: 0.1rem 0; }

    table {
      margin: 1rem auto;
      border-collapse: collapse;
      color: #fff;
    }
    table, th, td {
      border: 1px solid #666;
      padding: 0.5rem 1rem;
    }

    #live-counter {
      text-align: center;
      font-weight: bold;
      margin-top: 0.5rem;
    }

    .dot {
      color: #ff4d4d;
      font-weight: bold;
      animation: blink 2s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    #fade {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: black;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5rem;
      z-index: 9999;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
  </style>
</head>
<body>
  <div id="fade"><span id="scan-status">Scanning<span id="scan-dots">.</span></span></div>

  <h1>PROOF</h1>
  <p class="tagline" style="text-align:center;">Upload a photo â€” See if it âœ… Checks Out or âŒ Feels Off.</p>

  <div id="main-content">
    <div class="upload-box" onclick="this.querySelector('input').click();">
      <div style="font-size: 2rem;">ğŸ“·</div>
      <div>Upload Photo</div>
      <input type="file" class="photo-input" accept="image/*" style="display: none" onchange="handleFileUpload(this.files[0])" />
    </div>
    <div id="live-counter">
      <h3><span class="dot">â—</span> <span id="counter-num">...</span> â€” Results Issued and Counting!</h3>
    </div>

    <div class="section" style="text-align:left;">
      <h2>What is Proof?</h2>
      <p>When you upload a photo, Proof extracts something called <strong>metadata</strong> ğŸ“š<br>
      Itâ€™s made up of <strong>1â€™s and 0â€™s</strong> â€” invisible digital signals the human eye canâ€™t see,<br>
      but together, they tell a unique story about the imageâ€™s journey ğŸ–¼ï¸.</p>
    </div>

    <div class="section" style="text-align: center;">
      <img src="/static/spoof_g_j.jpg" alt="Grandma Sample" class="example-image">
      <h3>My grandma and I in NYC ğŸ—½</h3>
      <p>To the human eye, the lighting feels natural, the setting looks real, and nothing seems obviously edited.</p>
    </div>
<div class="section" style="margin-top: -1rem; text-align: left; max-width: 700px; margin-left: auto; margin-right: auto;">
      <h3>What Proof Sees: âŒ Feels Off</h3>
      <div class="group-block">
        <p><strong>â†’ Was it Born Real?</strong></p>
        <p>1. Was this photo taken with a real phone or camera? â†’ âœ… Yes</p>
        <p>2. Does it still have the original date and time? â†’ âŒ No</p>
        <p>3. Is the lighting and detail natural? â†’ âœ… Yes</p>
      </div>
      <div class="group-block">
        <p><strong>â†’ Was it Left Untouched?</strong></p>
        <p>4. No filters or beauty tools added? â†’ âœ… Yes</p>
        <p>5. No cropping or visual editing? â†’ âŒ No</p>
        <p>6. Has it only been saved once â€” not re-exported? â†’ âŒ No</p>
      </div>
      <div class="group-block">
        <p><strong>â†’ Was it Shared Naturally?</strong></p>
        <p>7. Is the original filename still intact? â†’ âŒ No</p>
        <p>8. Was it not reposted or downloaded from the internet? â†’ âŒ No</p>
        <p>9. Was it shared directly (like via AirDrop or text)? â†’ âŒ No</p>
      </div>
    </div>

    <div class="section" style="margin-top: -1rem; text-align: center;">
      <h3>Total: âœ… 3 Yes / âŒ 6 No</h3>
    </div>

    <div class="section" style="margin-top: -1rem;">
      <table>
        <thead>
          <tr><th>Total "Yes"</th><th>What That Means</th></tr>
        </thead>
        <tbody>
          <tr><td>7â€“9</td><td>âœ… Checks Out</td></tr>
          <tr><td>4â€“6</td><td>âš ï¸ Use Caution</td></tr>
          <tr><td>0â€“3</td><td>âŒ Feels Off</td></tr>
        </tbody>
      </table>
      <h3>Summary:</h3>
      <p>While the photo seems real at first glance, the metadata tells another story â€” signs of edits, multiple saves, and indirect sharing suggest itâ€™s been through a few digital hands.</p>

      <div class="upload-box" onclick="this.querySelector('input').click();">
        <div style="font-size: 2rem;">ğŸ“·</div>
        <div>Upload Photo</div>
        <input type="file" class="photo-input" accept="image/*" style="display: none" onchange="handleFileUpload(this.files[0])" />
      </div>
    </div>

    <footer style="text-align: center; margin-top: 3rem; font-size: 0.95rem; color: #999;">
      contactus@proofme.ai
    </footer>
  </div>

  <div id="preview-section" style="display:none; text-align:center;">
    <img id="preview-image" />
    <br>
    <button class="btn-submit" id="submit-btn" disabled style="opacity:0.5;" onclick="submitPhoto()">Submit Photo</button>
    <button class="btn-cancel" onclick="resetUpload()">Cancel</button>
  </div>

  <div id="results-section" style="display:none;">
    <img id="result-image" class="result-image" alt="Uploaded Photo" />
    <div id="verdict"></div>
    <div class="clue-block" id="clues"></div>
    <div class="summary">
      <strong>Summary:</strong>
      <p id="summary"></p>
    </div>
    <button class="btn-blue" onclick="resetUpload()">Scan Another Photo ğŸ“·</button>
  </div>

<script>
let uploadedS3Key = null;
let uploadedImageURL = null;

function handleFileUpload(file) {
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function () {
    document.getElementById('main-content').style.display = 'none';
    document.getElementById('preview-section').style.display = 'block';
    document.getElementById('preview-image').src = reader.result;
  };
  reader.readAsDataURL(file);

  const formData = new FormData();
  formData.append("photo", file);

  fetch('/upload', {
    method: 'POST',
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    uploadedImageURL = data.image_url;
    uploadedS3Key = data.s3_key;
    document.getElementById('submit-btn').disabled = false;
    document.getElementById('submit-btn').style.opacity = 1;
  })
  .catch(err => {
    console.error("Upload failed:", err);
    alert('Upload failed.');
  });
}

function submitPhoto() {
  if (!uploadedS3Key || !uploadedImageURL) return;

  const submitBtn = document.querySelector('.btn-submit');
  submitBtn.disabled = true;
  submitBtn.style.opacity = 0.5;
  submitBtn.innerHTML = `Scanning<span id="scan-dots">.</span>`;

  let dotCount = 1;
  const scanDots = document.getElementById('scan-dots');
  const animateDots = setInterval(() => {
    dotCount = (dotCount % 3) + 1;
    scanDots.textContent = '.'.repeat(dotCount);
  }, 500);

  document.getElementById('fade').style.visibility = 'visible';
  document.getElementById('fade').style.opacity = 1;

  fetch('/submit', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ s3_key: uploadedS3Key })
  })
  .then(res => res.json())
  .then(data => {
    clearInterval(animateDots);
    document.getElementById('fade').style.opacity = 0;
    setTimeout(() => document.getElementById('fade').style.visibility = 'hidden', 300);

    if (!data.success || !data.result) {
      throw new Error(data.error || "Scan failed");
    }

    const r = data.result;
    const a = r.answers;
    const yesCount = r.yes_count;
    const noCount = r.no_count;
    const clueBlock = document.getElementById('clues');
    clueBlock.innerHTML = '';

    document.getElementById('preview-section').style.display = 'none';
    document.getElementById('results-section').style.display = 'block';
    document.getElementById('result-image').src = uploadedImageURL;
    document.getElementById('summary').textContent = r.response;

    let finalVerdict = '';
    if (yesCount >= 7) finalVerdict = 'âœ… Checks Out';
    else if (yesCount >= 4) finalVerdict = 'âš ï¸ Use Caution';
    else finalVerdict = 'âŒ Feels Off';

    document.getElementById('verdict').innerHTML = `
      <h2>Result: ${finalVerdict}</h2>
      <table>
        <thead><tr><th>Total "Yes"</th><th>What That Means</th></tr></thead>
        <tbody>
          <tr><td>7â€“9</td><td>âœ… Checks Out</td></tr>
          <tr><td>4â€“6</td><td>âš ï¸ Use Caution</td></tr>
          <tr><td>0â€“3</td><td>âŒ Feels Off</td></tr>
        </tbody>
      </table>`;

    const groups = [
      { key: 'born_real', label: 'Born Real?' },
      { key: 'left_untouched', label: 'Left Untouched?' },
      { key: 'shared_naturally', label: 'Shared Naturally?' }
    ];

    let index = 1;
    groups.forEach(group => {
      const title = document.createElement('p');
      title.textContent = `â†’ ${group.label}`;
      title.style.fontWeight = 'bold';
      clueBlock.appendChild(title);

      (a[group.key] || []).forEach(([q, ans]) => {
        const line = document.createElement('p');
        line.style.marginLeft = '1rem';
        line.textContent = `${index++}. ${q} â€” ${ans ? 'âœ… Yes' : 'âŒ No'}`;
        clueBlock.appendChild(line);
      });
    });
  })
  .catch(err => {
    clearInterval(animateDots);
    console.error("GPT Submit Error:", err);
    alert('Something went wrong during scanning.');
    submitBtn.disabled = false;
    submitBtn.style.opacity = 1;
    submitBtn.textContent = "Submit Photo";
  });
}

function resetUpload() {
  uploadedS3Key = null;
  uploadedImageURL = null;
  document.querySelectorAll('.photo-input').forEach(input => input.value = '');
  document.getElementById('main-content').style.display = 'block';
  document.getElementById('preview-section').style.display = 'none';
  document.getElementById('results-section').style.display = 'none';
}

function updateCounter() {
  fetch('/count')
    .then(res => res.json())
    .then(data => {
      document.getElementById('counter-num').textContent = data.count;
    })
    .catch(() => {
      document.getElementById('counter-num').textContent = '...';
    });
}

updateCounter();
setInterval(updateCounter, 5000);
</script>
</body>
</html>